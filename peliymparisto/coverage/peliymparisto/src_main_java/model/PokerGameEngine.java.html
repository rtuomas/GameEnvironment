<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="fi"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../../../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../../../jacoco-resources/report.gif" type="image/gif"/><title>PokerGameEngine.java</title><link rel="stylesheet" href="../../../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../../../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../../../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../../../index.html" class="el_report">peliymparisto (12.3.2021 13.16.32)</a> &gt; <a href="../../index.html" class="el_group">peliymparisto</a> &gt; <a href="../index.html" class="el_bundle">src/main/java</a> &gt; <a href="index.source.html" class="el_package">model</a> &gt; <span class="el_source">PokerGameEngine.java</span></div><h1>PokerGameEngine.java</h1><pre class="source lang-java linenums">package model;

import java.util.ArrayList;
import java.util.Arrays;

import controller.ControllerIF;

/**
 * The game engine for the poker game. It connects all the different classes needed to run the poker game.
 * @author ---
 * @version 1.3 11.03.2021
 */
public class PokerGameEngine extends Thread implements ModelIF {
	
	/** Interface with a connection to GUI */
	private ControllerIF controller;
	/** Interface with a connection to DAO */
	private DAOIF dao;
	private Deck deck;
	private Hand hand;
	private ArrayList&lt;Integer&gt; indexes;
<span class="nc" id="L22">	private static Double[] betTable = {0.1, 0.2, 0.4, 0.5, 0.6, 0.8, 1.0, 1.5, 2.0, 3.0, 4.0, 5.0, 10.0};</span>
	//Players bet (starting with 1.00)
<span class="nc" id="L24">	private static double bet = betTable[6];</span>
<span class="nc" id="L25">	private static double initialCredits = 100;</span>

	//Player variables
	private Player player1;
	private Player player2;
	//Game variables
<span class="nc" id="L31">	private String gameType = &quot;poker&quot;;</span>
	
	/**
	 * Constructor for the poker game engine.
	 * Controller and DAO are not needed for CLI to operate!
	 * @param controller is the class which started running the poker game
	 */
<span class="nc" id="L38">	public PokerGameEngine(ControllerIF controller) {</span>
<span class="nc" id="L39">		this.controller = controller;</span>
		//this.stats = new Statistics();
<span class="nc" id="L41">	}</span>
	
	/**
	 * This method uses Threads to run multiple events in the GUI simultaneously
	 */
	public void run() {
		//game functionality
<span class="nc" id="L48">		deck = new Deck ();</span>
<span class="nc" id="L49">		deck.shuffle();</span>
				// dealHand -&gt; hand to controller -&gt; hand to view
				// update credits -&gt; controller -&gt; view
				// get score -&gt; controller -&gt; view
				// database stuff
				// thread ends
<span class="nc" id="L55">		dealCards();</span>
<span class="nc" id="L56">		swapCards();</span>
<span class="nc" id="L57">		endGame(); //called when the game ends</span>
<span class="nc" id="L58">		setScore(); //shows the result in View</span>
<span class="nc" id="L59">	}</span>
	
	/**
	 * Controller calls this method before starting the game
	 */
	public void setUpSinglePlayerGame(Player player) {
<span class="nc" id="L65">		this.player1 = player;</span>
<span class="nc" id="L66">		this.player2 = dao.getPlayer(1000);</span>
<span class="nc" id="L67">	}</span>
	
	/**	{@inheritDoc} */
	@Override
	public void setDatabaseConnection(DAOIF dao) {
<span class="nc" id="L72">		this.dao = dao;</span>
<span class="nc" id="L73">	}</span>
	
	/**
	 * This method is ran at the end of the game to save the played game into database and update credit amounts to players.
	 */
	public void endGame() {
    PlayedGame currentGame;
    Player winner;
    Player loser;
    
<span class="nc" id="L83">    double creditChange = hand.worth() * bet;</span>
    
<span class="nc bnc" id="L85" title="All 2 branches missed.">    if(hand.wins()){</span>
<span class="nc" id="L86">      winner = player1;</span>
<span class="nc" id="L87">      loser = player2;</span>
<span class="nc" id="L88">    } else {</span>
<span class="nc" id="L89">      winner = player2;</span>
<span class="nc" id="L90">      loser = player1;</span>
    }
    
<span class="nc" id="L93">    winner.alterCredits(creditChange - bet);</span>
<span class="nc" id="L94">    loser.alterCredits(-creditChange - bet);</span>
    
<span class="nc" id="L96">    currentGame = new PlayedGame(player1,player2,gameType,winner,creditChange-bet);</span>
    
<span class="nc bnc" id="L98" title="All 2 branches missed.">		if(player1.getCredits() &lt;= 0){</span>
<span class="nc" id="L99">		  player1.setCredits(initialCredits);</span>
<span class="nc" id="L100">		  controller.notifyCreditReset();</span>
		}

<span class="nc" id="L103">		dao.createPlayedGame(currentGame);</span>
<span class="nc" id="L104">		dao.updatePlayer(player1);</span>
<span class="nc" id="L105">		dao.updatePlayer(player2);</span>
<span class="nc" id="L106">		controller.setCurrentPlayer();</span>
<span class="nc" id="L107">	}</span>
	
	@Override
	public void dealCards () {
<span class="nc" id="L111">		this.hand = new Hand(deck);</span>
<span class="nc" id="L112">		controller.showCards(this.hand.getHand());</span>
<span class="nc" id="L113">	}</span>
	
	/**
	 * Returns current bet amount
	 * @return current bet amount
	 */
	public static double getBet() {
<span class="nc" id="L120">		return bet;</span>
	}
	
	/**
	 * increases current bet amount
	 * @return current bet amount
	 */
	public static double increaseBet() {
<span class="nc bnc" id="L128" title="All 2 branches missed.">		if(bet!=10.0) {</span>
<span class="nc" id="L129">			bet = betTable[Arrays.asList(betTable).indexOf(bet)+1];</span>
		}
<span class="nc" id="L131">		return getBet();</span>
	}
	
	/**
	 * decreases current bet amount
	 * @return current bet amount
	 */
	public static double decreaseBet() {
<span class="nc bnc" id="L139" title="All 2 branches missed.">		if(bet!=0.1) {</span>
<span class="nc" id="L140">			bet = betTable[Arrays.asList(betTable).indexOf(bet)-1];</span>
		}
<span class="nc" id="L142">		return getBet();</span>
	}
	
	@Override
	public void setScore () {
<span class="nc" id="L147">		HandValue score = this.hand.getScore();</span>
<span class="nc" id="L148">		String s = &quot;&quot;;</span>
		
<span class="nc bnc" id="L150" title="All 10 branches missed.">		switch(score) {</span>
		case ACE_PAIR:
<span class="nc" id="L152">			s = &quot;Ässä pari&quot;;</span>
<span class="nc" id="L153">			break;</span>
		case TWO_PAIRS:
<span class="nc" id="L155">			s = &quot;Kaksi paria&quot;;</span>
<span class="nc" id="L156">			break;</span>
		case THREE_OF_A_KIND:
<span class="nc" id="L158">			s = &quot;Kolmoset&quot;;</span>
<span class="nc" id="L159">			break;</span>
		case STRAIGHT:
<span class="nc" id="L161">			s = &quot;Suora&quot;;</span>
<span class="nc" id="L162">			break;</span>
		case FLUSH:
<span class="nc" id="L164">			s = &quot;Väri&quot;;</span>
<span class="nc" id="L165">			break;</span>
		case FULL_HOUSE:
<span class="nc" id="L167">			s = &quot;Täyskäsi&quot;;</span>
<span class="nc" id="L168">			break;</span>
		case FOUR_OF_A_KIND:
<span class="nc" id="L170">			s = &quot;Neloset&quot;;</span>
<span class="nc" id="L171">			break;</span>
		case STRAIGHT_FLUSH:
<span class="nc" id="L173">			s = &quot;Värisuora&quot;;</span>
<span class="nc" id="L174">			break;</span>
		case NO_WIN:
<span class="nc" id="L176">			s = &quot;Ei voittoa&quot;;</span>
			break;
		}
		
<span class="nc bnc" id="L180" title="All 2 branches missed.">		if(score.getMultiplier() != 0) {</span>
<span class="nc" id="L181">			controller.setScore(s + &quot;, voitit &quot; + score.getMultiplier() * bet);</span>
<span class="nc" id="L182">		} else {</span>
<span class="nc" id="L183">			controller.setScore(s);</span>
		}
<span class="nc" id="L185">	}</span>
	
	/**
	 * Waits for user interaction until user has decided which cards are going to get swapped.
	 * Swaps cards and returns new hand to controller -&gt; view.
	 */
	public synchronized void swapCards () {
<span class="nc bnc" id="L192" title="All 2 branches missed.">		while(this.indexes == null) {</span>
			try {
<span class="nc" id="L194">				wait();</span>
<span class="nc" id="L195">			} catch (InterruptedException e) {</span>
<span class="nc" id="L196">				e.printStackTrace();</span>
			}
		}
<span class="nc" id="L199">		controller.showCards(hand.swapCards(this.indexes));</span>
<span class="nc" id="L200">	}</span>
	
	/**
	 * Sets up ArrayList which cards are going to get swapped.
	 */
	public synchronized void setCardsToSwapIndexes(ArrayList&lt;Integer&gt; indexes) {
<span class="nc" id="L206">		this.indexes = new ArrayList&lt;&gt;(indexes);</span>
<span class="nc" id="L207">		notifyAll();</span>
<span class="nc" id="L208">	}</span>
	
	public Player getCurrentPlayer() {
<span class="nc" id="L211">		return this.player1;</span>
	}
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.5.201910111838</span>peliymparisto (12.3.2021 13.16.32)</div></body></html>